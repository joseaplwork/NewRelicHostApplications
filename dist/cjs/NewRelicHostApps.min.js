"use strict";function hashCode(t){var e=0;if(0===t.length)return e;for(var s=0;s<t.length;s+=1)e=(e<<5)-e+t.charCodeAt(s),e&=e;return e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,s,r){return s&&t(e.prototype,s),r&&t(e,r),e}}(),NewRelicHostApps=function(){function t(e){_classCallCheck(this,t),this.MAX_MOST_SATISFING=25;var s=this.constructor.getHashedApps(e);this.apps=this.constructor.sortAppsByApdex(s)}return _createClass(t,[{key:"_getMostSatisfyingApps",value:function(t){var e=t.length>=this.MAX_MOST_SATISFING?this.MAX_MOST_SATISFING:t.length;return t.slice(0,e)}},{key:"_filterByOccurrence",value:function(t,e){return this.apps.filter(function(s){return s[t].includes(e)})}},{key:"getTopAppsByHost",value:function(t){var e=this._filterByOccurrence("host",t);return this._getMostSatisfyingApps(e)}},{key:"_sortedPush",value:function(t){var e=this.apps;if(!e.length)return this.apps.push(this.constructor.getHashedApp(t)),this.apps;if(e[0].apdex<=t.apdex)return this.apps.unshift(this.constructor.getHashedApp(t)),this.apps;if(e[e.length-1].apdex>=t.apdex)return this.apps.push(this.constructor.getHashedApp(t)),this.apps;for(var s=0;s<e.length;s+=1)if(e[s].apdex<=t.apdex){this.apps.splice(s,0,this.constructor.getHashedApp(t));break}return this.apps}},{key:"addAppToHosts",value:function(t){var e=this._sortedPush(t);return this._getMostSatisfyingApps(e)}},{key:"_removeFromApps",value:function(t){var e=this.apps;if(!e.length)return this.apps;var s=e.length-1;if(e[0].$$id===t||e[s].$$id===t){var r=e[0].$$id===t?0:s;return this.apps.splice(r,1),this.apps}for(var n=0;n<e.length;n+=1)if(e[n].$$id===t){this.apps.splice(n,1);break}return this.apps}},{key:"removeAppFromHosts",value:function(t){var e=this._removeFromApps(t);return this._getMostSatisfyingApps(e)}}],[{key:"getHashedApps",value:function(t){if(!t)return null;for(var e=t,s=0;s<t.length;s+=1)e[s].$$id=hashCode(JSON.stringify(e[s]));return e}},{key:"getHashedApp",value:function(t){return Object.assign({},{$$id:hashCode(JSON.stringify(t))},t)}},{key:"sortAppsByApdex",value:function(t){return t&&t.length?t.sort(function(t,e){return t.apdex===e.apdex?0:t.apdex<e.apdex?1:-1}):[]}}]),t}();module.exports=NewRelicHostApps;
